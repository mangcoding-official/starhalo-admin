import{c as F,r as N,u as I,a as A,j as e,b as L,B as C,o as P,t as g,A as D,s as M,e as v,d as R}from"./index-PJSoALqW.js";import{C as T,a as U,b as B,c as H,d as O}from"./card-C33P-Zxd.js";import{A as V}from"./auth-layout-Dbgjer3I.js";import{u as G,a as q,F as z,b as h,c as x,d as j,e as y,f as b}from"./form-CZtHTW_x.js";import{a as J}from"./api-client-d_HjdnGb.js";import{I as K}from"./input-jRkzR5wK.js";import{P as Q}from"./password-input-CIDL4bmy.js";import{L as W}from"./loader-circle-DeN8EvR0.js";import"./logo-C1ds4uEV.js";import"./index-mV3cxRO_.js";import"./eye-CZlXJMJC.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],Y=F("log-in",X),Z="/api/auth/admin/login";function _(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function $(s){if(!s||!s.data||typeof s.data=="boolean"||!_(s.data))return null;const t=s.data,i=typeof t=="object"&&t!==null?t.expires_in:void 0;let n=null;if(typeof i=="number")n=Number.isFinite(i)?i:null;else if(typeof i=="string"){const c=Number(i);n=Number.isFinite(c)?c:null}return typeof t.access_token!="string"||typeof t.refresh_token!="string"||typeof t.token_type!="string"||!_(t.user)?null:{access_token:t.access_token,refresh_token:t.refresh_token,token_type:t.token_type,expires_in:n,user:t.user}}function f(s){if(s&&typeof s.message=="string"&&s.message.trim().length>0)return s.message}function k(s,t,i){const n=t?.errors;!n||typeof n!="object"||Object.entries(n).forEach(([c,l])=>{const m=typeof l=="string"?l:Array.isArray(l)?l.filter(o=>typeof o=="string").join(", "):i;m&&(c in s.getValues()?s.setError(c,{message:m}):s.setError("root",{message:m}))})}const ee=P({email:v({error:s=>s.input===""?"Please enter your email":void 0}),password:M().min(1,"Please enter your password").min(7,"Password must be at least 7 characters long")});function se({className:s,redirectTo:t,...i}){const[n,c]=N.useState(!1),l=I(),{auth:m}=A(),o=G({resolver:q(ee),defaultValues:{email:"",password:""}});async function S(u){c(!0),o.clearErrors();try{const{data:a}=await J.post(Z,u),r=$(a);if(!r){const d=f(a)??"Unable to sign in. Please try again.";throw k(o,a,d),o.formState.errors.root||o.setError("root",{message:d}),new Error(d)}const p=typeof r.expires_in=="number"&&r.expires_in>0?r.expires_in:null,w=p!==null?Date.now()+p*1e3:null;m.setSession({accessToken:r.access_token,refreshToken:r.refresh_token,tokenType:r.token_type,expiresAt:w}),m.setUser(r.user);const E=f(a)??"Login successfully";g.success(E),l({to:t||"/users",replace:!0})}catch(a){let r="Unable to sign in. Please try again.";if(a instanceof D){const p=a.response?.data??null;k(o,p,r),r=f(p)??r}else a instanceof Error&&a.message&&(r=a.message);!o.formState.errors.root&&r&&o.setError("root",{message:r}),g.error(r)}finally{c(!1)}}return e.jsx(z,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(S),className:L("grid gap-3",s),...i,children:[e.jsx(h,{control:o.control,name:"email",render:({field:u})=>e.jsxs(x,{children:[e.jsx(j,{children:"Email"}),e.jsx(y,{children:e.jsx(K,{placeholder:"name@example.com",...u})}),e.jsx(b,{})]})}),e.jsx(h,{control:o.control,name:"password",render:({field:u})=>e.jsxs(x,{className:"relative",children:[e.jsx(j,{children:"Password"}),e.jsx(y,{children:e.jsx(Q,{placeholder:"********",...u})}),e.jsx(b,{})]})}),e.jsxs(C,{className:"mt-2",disabled:n,type:"submit",children:[n?e.jsx(W,{className:"animate-spin"}):e.jsx(Y,{}),"Sign in"]}),o.formState.errors.root?.message?e.jsx("p",{className:"text-destructive text-sm font-medium",children:o.formState.errors.root.message}):null]})})}function re(){const{redirect:s}=R({from:"/(auth)/sign-in"});return e.jsx(V,{children:e.jsxs(T,{className:"gap-4",children:[e.jsxs(U,{children:[e.jsx(B,{className:"text-lg tracking-tight",children:"Sign in"}),e.jsxs(H,{children:["Enter your email and password below to ",e.jsx("br",{}),"log into your account"]})]}),e.jsx(O,{children:e.jsx(se,{redirectTo:s})})]})})}const ge=re;export{ge as component};
