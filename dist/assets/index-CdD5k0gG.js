import{r as g,j as e,R as q,o as v,x as de,s as n,y as pe,z as k,n as b,u as N,B as H,l as Q,i as ue,k as me,C as ge,t as K}from"./index-D3NPveco.js";import{a as xe,u as fe,H as he,S as be}from"./search-DGDFI4xk.js";import{M as je}from"./main-M3t2zLu9.js";import{T as we}from"./theme-switch-Cc1gv-2A.js";import{C as ve}from"./config-drawer-BOZOmPdm.js";import{P as ye}from"./profile-dropdown-TIbTcRk6.js";import{D as w,u as Se,a as Ne,g as Re,b as Ce,d as De,c as _e,e as Me,f as Pe,h as Te,T as Fe,i as Ie,j as _,k as ke,l as z,m as Ae,n as A,o as Ve}from"./toolbar-Bj-k75sj.js";import{S as He}from"./skeleton-B5rHEncB.js";import{B as O}from"./badge-Kp1b-HXG.js";import{g as Ke}from"./get-row-serial-lFSYfpsv.js";import{D as Ee}from"./react-icons.esm-3kbhK4Wj.js";import{D as ze,f as Ue,g as Be,j as U}from"./dropdown-menu-BCYxb1oP.js";import{i as Le,u as qe}from"./id-DkSDnNKI.js";import{f as $}from"./format-DMm6umYn.js";import{a as G}from"./api-client-QQq-wIhq.js";import{D as J,a as W,b as X,c as Y,d as Z,e as Qe}from"./command-CImZOo8a.js";import{S as Oe,a as $e,b as Ge,c as Je,d as We}from"./select-B8V2QOwk.js";import"./separator-fNd7YUqQ.js";import"./index-CUhw26c5.js";import"./index-Bs54XTPB.js";import"./index-Dk6xqxMW.js";import"./index-CsCFIuwR.js";import"./check-B4ZP-tm0.js";import"./index-CJw4kmEm.js";import"./index-DVt2Q-7a.js";import"./index-BWC4LGWb.js";import"./index-Q8mwsH7E.js";import"./index-hhb2EvcI.js";import"./layout-provider-8bzNZRTL.js";import"./input-6qCb2yCg.js";import"./popover-Cthf4V8P.js";import"./index-CLVqzXn2.js";import"./index-Cqg7MwP1.js";import"./chevron-down-BLvtA-0r.js";const ee=q.createContext(null);function Xe({children:s}){const[t,r]=xe(null),[a,o]=g.useState(null);return e.jsx(ee.Provider,{value:{open:t,setOpen:r,currentRow:a,setCurrentRow:o},children:s})}function te(){const s=q.useContext(ee);if(!s)throw new Error("useReports must be used within <ReportsProvider>");return s}const Ye=pe(["pending","resolve"]),se=v({id:n(),reporterId:n().nullable(),reporterName:n(),reportedId:n().nullable(),reportedName:n(),reason:n(),status:Ye,createdAt:de().nullable()}),re=v({id:k([n(),b()]),reason:n().nullable().optional(),status:n().nullable().optional(),reporter:v({id:k([n(),b()]).nullable().optional(),name:n().nullable().optional(),email:n().nullable().optional()}).partial().nullable().optional(),reporter_name:n().nullable().optional(),reporter_email:n().nullable().optional(),reported:v({id:k([n(),b()]).nullable().optional(),name:n().nullable().optional(),email:n().nullable().optional()}).partial().nullable().optional(),reported_name:n().nullable().optional(),reported_email:n().nullable().optional(),created_at:n().nullable().optional(),updated_at:n().nullable().optional()});function V(...s){for(const t of s)if(typeof t=="string"){const r=t.trim();if(r.length>0&&r.toLowerCase()!=="null")return r}return""}function Ze(s){return(s??"").toLowerCase()==="resolve"?"resolve":"pending"}function et(s){if(!s)return null;const t=new Date(s);return Number.isNaN(t.getTime())?null:t}function tt(s){const t=re.parse(s),r=V(t.reporter?.name,t.reporter_name,t.reporter_email)||"Unknown reporter",a=V(t.reported?.name,t.reported_name,t.reported_email)||"Unknown user",o=t.reporter?.id!==null&&typeof t.reporter?.id<"u"?String(t.reporter.id):null,l=t.reported?.id!==null&&typeof t.reported?.id<"u"?String(t.reported.id):null,m=V(t.reason)||"No reason provided",c={id:String(t.id),reporterId:o,reporterName:r,reportedId:l,reportedName:a,reason:m,status:Ze(t.status),createdAt:et(t.created_at??t.updated_at)};return se.parse(c)}function st({row:s}){const{setCurrentRow:t,setOpen:r}=te(),a=se.parse(s.original),{t:o}=N();return e.jsxs(ze,{modal:!1,children:[e.jsx(Ue,{asChild:!0,children:e.jsxs(H,{variant:"ghost",className:"flex h-8 w-8 p-0 data-[state=open]:bg-muted",children:[e.jsx(Ee,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:o("reports.rowActions.openMenu","Open menu")})]})}),e.jsxs(Be,{align:"end",className:"w-[160px]",children:[e.jsx(U,{onClick:()=>{t(a),r("view")},children:o("reports.rowActions.viewDetails","View details")}),e.jsx(U,{onClick:()=>{t(a),r("status")},children:o("reports.rowActions.updateStatus","Update Status")})]})]})}function rt(s){return[{id:"no",header:({column:t})=>e.jsx(w,{column:t,title:s("reports.columns.number","No")}),enableSorting:!1,enableHiding:!1,size:48,cell:({row:t,table:r})=>e.jsx("span",{className:"font-mono text-xs",children:Ke(r,t.index)})},{accessorKey:"reporterName",header:({column:t})=>e.jsx(w,{column:t,title:s("reports.columns.reporter","Reporter")}),cell:({row:t})=>e.jsx("span",{className:"font-medium",children:t.original.reporterName}),enableSorting:!1},{accessorKey:"reportedName",header:({column:t})=>e.jsx(w,{column:t,title:s("reports.columns.reported","Reported User")}),cell:({row:t})=>e.jsx("span",{children:t.original.reportedName}),enableSorting:!1},{accessorKey:"reason",header:({column:t})=>e.jsx(w,{column:t,title:s("reports.columns.reason","Reason")}),cell:({row:t})=>{const r=t.original.reason;return e.jsx("span",{className:"text-sm text-muted-foreground",children:r})},enableSorting:!1},{accessorKey:"status",header:({column:t})=>e.jsx(w,{column:t,title:s("reports.columns.status","Status")}),cell:({row:t})=>{const r=t.original.status,a=r==="resolve"?"default":"secondary";return e.jsx(O,{variant:a,children:s(`reports.status.${r}`,r)})}},{accessorKey:"createdAt",header:({column:t})=>e.jsx(w,{column:t,title:s("reports.columns.created","Created")}),cell:({row:t})=>{const r=t.original.createdAt;return r?e.jsx("span",{children:$(r,"dd MMM yyyy HH:mm",{locale:Le})}):e.jsx("span",{className:"text-muted-foreground",children:"—"})},sortingFn:"datetime"},{id:"actions",cell:({row:t})=>e.jsx(st,{row:t})}]}const ae=[{label:"Pending",labelKey:"reports.status.pending",value:"pending"},{label:"Resolved",labelKey:"reports.status.resolve",value:"resolve"}],B=Q("/_authenticated/reports/");function at({data:s,total:t,pageCount:r,isLoading:a,isFetching:o,sorting:l,onSortingChange:m}){const{t:c}=N(),[h,d]=g.useState({}),x=g.useMemo(()=>rt(c),[c]),{globalFilter:i,onGlobalFilterChange:y,columnFilters:R,onColumnFiltersChange:M,pagination:S,onPaginationChange:P,ensurePageInRange:j}=Se({search:B.useSearch(),navigate:B.useNavigate(),pagination:{defaultPage:1,defaultPageSize:10},globalFilter:{enabled:!0,key:"s",trim:!0},columnFilters:[{columnId:"status",searchKey:"status",type:"string"}]}),f=Ne({data:g.useMemo(()=>s,[s]),columns:x,state:{sorting:l,columnVisibility:h,globalFilter:i,columnFilters:R,pagination:S},manualPagination:!0,pageCount:r,manualSorting:!0,autoResetPageIndex:!1,onPaginationChange:P,onSortingChange:m,onColumnFiltersChange:M,onGlobalFilterChange:y,onColumnVisibilityChange:d,getCoreRowModel:Pe(),getFilteredRowModel:Me(),getSortedRowModel:_e(),getPaginationRowModel:De(),getFacetedRowModel:Ce(),getFacetedUniqueValues:Re(),globalFilterFn:(p,u,D)=>{if(!D)return!0;const I=String(D).toLowerCase(),le=String(p.getValue("reporterName")).toLowerCase(),ie=String(p.getValue("reportedName")).toLowerCase(),ce=String(p.getValue("reason")).toLowerCase();return le.includes(I)||ie.includes(I)||ce.includes(I)}});g.useEffect(()=>{!a&&!o&&j(r)},[j,r,o,a]);const T=f.getVisibleLeafColumns(),C=T.length||x.length,F=Math.min(f.getState().pagination?.pageSize??10,10),E=a||o,ne=t===0&&!E;return e.jsxs("div",{className:"space-y-4 max-sm:has-[div[role='toolbar']]:mb-16",children:[e.jsx(Te,{table:f,searchPlaceholder:c("reports.table.searchPlaceholder","Filter by reporter, reported user, or reason..."),filters:[{columnId:"status",title:c("reports.table.filters.status","Status"),options:ae.map(p=>({label:c(p.labelKey,p.label),value:p.value}))}]}),e.jsx("div",{className:"overflow-hidden rounded-md border",children:e.jsxs(Fe,{children:[e.jsx(Ie,{children:f.getHeaderGroups().map(p=>e.jsx(_,{children:p.headers.map(u=>e.jsx(ke,{colSpan:u.colSpan,children:u.isPlaceholder?null:z(u.column.columnDef.header,u.getContext())},u.id))},p.id))}),e.jsx(Ae,{children:E?Array.from({length:F}).map((p,u)=>e.jsx(_,{children:T.map(D=>e.jsx(A,{children:e.jsx(He,{className:"h-4 w-full max-w-[220px]"})},D.id))},`loading-${u}`)):f.getRowModel().rows?.length?f.getRowModel().rows.map(p=>e.jsx(_,{children:p.getVisibleCells().map(u=>e.jsx(A,{children:z(u.column.columnDef.cell,u.getContext())},u.id))},p.id)):e.jsx(_,{children:e.jsx(A,{colSpan:C,className:"h-24 text-center",children:ne?c("reports.table.empty.noReports","No reports found."):c("reports.table.empty.noResults","No results.")})})})]})}),e.jsx(Ve,{table:f})]})}const ot=v({current_page:b().int().nonnegative(),last_page:b().int().nonnegative().optional(),per_page:b().int().positive(),total:b().int().nonnegative(),next_page_url:n().nullable().optional(),prev_page_url:n().nullable().optional()}),nt=v({message:n().optional(),data:ue(re),meta:ot});function lt({page:s=1,perPage:t=10,search:r,status:a,sort:o}){return{page:s,per_page:t,...r&&r.trim().length>0?{s:r.trim()}:{},...a&&a.trim().length>0?{status:a.trim()}:{},...o?{sort:o}:{}}}async function it(s={}){const t=await G.get("/api/admin/followers/report",{params:lt(s)}),r=nt.safeParse(t.data);if(!r.success)throw new Error("Unable to parse reports response.");const a=r.data.data.map(tt),o=r.data.meta,l=typeof o.next_page_url<"u"?!!o.next_page_url:typeof o.last_page=="number"?o.current_page<o.last_page:!1,m=typeof o.prev_page_url<"u"?!!o.prev_page_url:o.current_page>1;return{reports:a,pagination:{page:o.current_page,perPage:o.per_page,total:o.total,lastPage:o.last_page,hasNext:l,hasPrevious:m},rawMessage:r.data.message}}const oe=["admin","reports"];function ct({page:s,perPage:t,search:r,status:a,sort:o,enabled:l=!0}){return fe({queryKey:[...oe,{page:s??1,perPage:t??10,search:r??"",status:a??"",sort:o??"desc"}],queryFn:()=>it({page:s??1,perPage:t??10,search:r??"",status:a??"",sort:o??"desc"}),placeholderData:me,enabled:l,staleTime:1e3*30})}async function dt(s,t){const r=await G.put(`/api/admin/followers/report/${s}`,t);return r.data&&typeof r.data.message=="string"?r.data.message:"Report status updated successfully."}function pt({report:s,open:t,onOpenChange:r}){const{t:a}=N();if(!s)return null;const o=s.createdAt?$(s.createdAt,"dd MMM yyyy HH:mm"):a("reports.viewDialog.notAvailable","Not available"),l=s.status==="resolve"?"default":"secondary";return e.jsx(J,{open:t,onOpenChange:r,children:e.jsxs(W,{className:"sm:max-w-lg space-y-4",children:[e.jsxs(X,{children:[e.jsx(Y,{children:a("reports.viewDialog.title","Report details")}),e.jsx(Z,{children:a("reports.viewDialog.subtitle","Review the full report information.")})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold uppercase text-muted-foreground",children:a("reports.columns.status","Status")}),e.jsx(O,{variant:l,children:a(`reports.status.${s.status}`,s.status)})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold uppercase text-muted-foreground",children:a("reports.columns.reason","Reason")}),e.jsx("p",{className:"rounded-md border bg-muted/30 p-3 text-sm whitespace-pre-wrap",children:s.reason})]}),e.jsxs("section",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"rounded-md border bg-muted/20 p-3",children:[e.jsx("p",{className:"text-xs font-semibold uppercase text-muted-foreground",children:a("reports.columns.reporter","Reporter")}),e.jsx("p",{className:"text-sm font-medium",children:s.reporterName}),s.reporterId?e.jsx("p",{className:"text-xs text-muted-foreground",children:a("reports.viewDialog.reporterId","ID: {id}").replace("{id}",s.reporterId)}):null]}),e.jsxs("div",{className:"rounded-md border bg-muted/20 p-3",children:[e.jsx("p",{className:"text-xs font-semibold uppercase text-muted-foreground",children:a("reports.columns.reported","Reported User")}),e.jsx("p",{className:"text-sm font-medium",children:s.reportedName}),s.reportedId?e.jsx("p",{className:"text-xs text-muted-foreground",children:a("reports.viewDialog.reportedId","ID: {id}").replace("{id}",s.reportedId)}):null]})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold uppercase text-muted-foreground",children:a("reports.columns.created","Created")}),e.jsx("p",{className:"text-sm",children:o})]})]})})}function ut(){const{open:s,setOpen:t,currentRow:r,setCurrentRow:a}=te(),o=()=>{a(null),t(null)};return e.jsxs(e.Fragment,{children:[e.jsx(pt,{report:r,open:!!r&&s==="view",onOpenChange:l=>{l?t("view"):o()}}),r?e.jsx(mt,{open:s==="status",onOpenChange:l=>{l?t("status"):o()},reportId:r.id,initialStatus:r.status,reporterName:r.reporterName,reportedName:r.reportedName}):null]})}function mt({open:s,onOpenChange:t,reportId:r,initialStatus:a,reporterName:o,reportedName:l}){const[m,c]=g.useState(a),h=ge(),{t:d}=N();g.useEffect(()=>{s&&c(a)},[a,s]);const x=qe({mutationFn:async i=>dt(r,{status:i}),onSuccess:async i=>{await h.invalidateQueries({queryKey:oe,exact:!1}),K.success(i??d("reports.api.updateSuccess","Report status updated.")),t(!1)},onError:i=>{const y=i instanceof Error?i.message:d("reports.api.updateError","Failed to update report.");K.error(y)}});return e.jsx(J,{open:s,onOpenChange:t,children:e.jsxs(W,{className:"sm:max-w-md",children:[e.jsxs(X,{children:[e.jsx(Y,{children:d("reports.dialog.title","Update Report Status")}),e.jsx(Z,{children:d("reports.dialog.description","Reporter: {reporter} · Reported user: {reported}").replace("{reporter}",o).replace("{reported}",l)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:d("reports.dialog.statusLabel","Status")}),e.jsxs(Oe,{value:m,onValueChange:i=>c(i),children:[e.jsx($e,{className:"w-full",children:e.jsx(Ge,{placeholder:d("reports.dialog.statusPlaceholder","Select status")})}),e.jsx(Je,{children:ae.map(i=>e.jsx(We,{value:i.value,children:d(i.labelKey,i.label)},i.value))})]})]}),e.jsxs(Qe,{children:[e.jsx(H,{variant:"outline",onClick:()=>t(!1),disabled:x.isPending,children:d("reports.dialog.cancel","Cancel")}),e.jsx(H,{onClick:()=>x.mutate(m),disabled:x.isPending,children:x.isPending?d("reports.dialog.saving","Saving..."):d("reports.dialog.save","Save")})]})]})})}const L=Q("/_authenticated/reports/");function gt(){const s=L.useSearch(),t=L.useNavigate(),{t:r}=N(),a=s.page??1,o=s.pageSize??10,l=typeof s.s=="string"&&s.s.trim().length>0?s.s:void 0,m=typeof s.status=="string"&&s.status.trim().length>0?s.status:void 0,c=s.sort==="asc"?"asc":"desc",{data:h,error:d,isLoading:x,isFetching:i}=ct({page:a,perPage:o,search:l,status:m,sort:c});g.useEffect(()=>{d instanceof Error&&K.error(d.message)},[d]);const y=h?.reports??[],R=h?.pagination.total??0,M=h?.pagination.lastPage??(o>0?Math.max(1,Math.ceil(R/(o||1))):1),S=g.useMemo(()=>[{id:"createdAt",desc:c!=="asc"}],[c]),P=g.useCallback(j=>{const C=(typeof j=="function"?j(S):j)[0]?.desc===!1?"asc":"desc";t({search:F=>({...F,page:void 0,sort:C==="desc"?void 0:C})})},[t,S]);return e.jsxs(Xe,{children:[e.jsxs(he,{fixed:!0,children:[e.jsx(be,{}),e.jsxs("div",{className:"ms-auto flex items-center space-x-4",children:[e.jsx(we,{}),e.jsx(ve,{}),e.jsx(ye,{})]})]}),e.jsxs(je,{children:[e.jsx("div",{className:"mb-2 flex flex-wrap items-center justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:r("reports.page.title","Reports")}),e.jsx("p",{className:"text-muted-foreground",children:r("reports.page.description","Review and resolve user reports.")})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(at,{data:y,total:R,pageCount:M,isLoading:x,isFetching:i,sorting:S,onSortingChange:P})})]}),e.jsx(ut,{})]})}const Jt=gt;export{Jt as component};
