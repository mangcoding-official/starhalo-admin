import{r as b,j as t,R as ge,B as V,o as g,x as A,E as R,s as o,y as X,n as p,h as H,i as fe,Z as ve,k as Ae,D as Re,t as D}from"./index-PJSoALqW.js";import{C as Fe}from"./config-drawer-DIpi6UgC.js";import{a as Ee,u as Ie,C as Ve,H as He,S as ke}from"./search-DNskT_XA.js";import{M as $e}from"./main-DIftAsZN.js";import{P as Oe}from"./profile-dropdown-zkoeqgxu.js";import{T as Ue}from"./theme-switch-D16jziMJ.js";import{P as ze}from"./plus-DCWCcU2j.js";import{D as P,u as Le,a as qe,g as Be,b as Ye,c as Ke,d as Qe,e as Ge,f as Ze,h as Je,T as Xe,i as We,j as F,k as et,l as ie,m as tt,n as q,o as at}from"./toolbar-FoxzrVPf.js";import{S as st}from"./skeleton-Dz89h62O.js";import{D as nt}from"./react-icons.esm-1898j_IC.js";import{D as it,f as ot,g as rt,j as oe,O as re,i as lt}from"./dropdown-menu-C13Htoa9.js";import{E as ct}from"./eye-CZlXJMJC.js";import{T as dt}from"./trash-2-CU3mGl9s.js";import{g as ut}from"./get-row-serial-lFSYfpsv.js";import{f as I}from"./format-DMm6umYn.js";import{i as B,u as Y}from"./id-Bl4OMirq.js";import{u as mt,a as pt,F as ht,b as K,c as Q,d as G,e as Z,f as J}from"./form-CZtHTW_x.js";import{s as gt}from"./show-submitted-data-M89gIccy.js";import{D as xe,a as je,b as be,c as ye,d as Ne,e as ft,f as xt}from"./command-Ckdq_yr7.js";import{I as le}from"./input-jRkzR5wK.js";import{T as jt}from"./textarea-CXQioPHx.js";import{a as k}from"./api-client-d_HjdnGb.js";import{B as bt}from"./badge-Wr05xGak.js";import"./index-CpUZSOZN.js";import"./index-CzxQJnmd.js";import"./index-mV3cxRO_.js";import"./index-FEBST65e.js";import"./index-DgPcTN26.js";import"./index-By7kRSW8.js";import"./index-n3OEIJtS.js";import"./index-B2ibKlVn.js";import"./layout-provider-BCzdurxv.js";import"./separator-FNUfim07.js";import"./index-CnZH9FRD.js";import"./check-CWRdaoHi.js";import"./select-BVNy0vOO.js";import"./index-CKm0aj0N.js";import"./index-B4y4BuXJ.js";import"./chevron-down-DWwXMWh-.js";import"./popover-oHmeJmNB.js";const we=ge.createContext(null);function yt({children:e}){const[a,s]=Ee(null),[n,r]=b.useState(null);return t.jsx(we.Provider,{value:{open:a,setOpen:s,currentRow:n,setCurrentRow:r},children:e})}const W=()=>{const e=ge.useContext(we);if(!e)throw new Error("usePushNotifications has to be used within <PushNotificationProvider>");return e};function Nt(){const{setOpen:e}=W();return t.jsx("div",{className:"flex gap-2",children:t.jsxs(V,{className:"space-x-1",onClick:()=>e("create"),children:[t.jsx("span",{children:"Create"})," ",t.jsx(ze,{size:18})]})})}const wt=["draft","scheduled","sent","canceled","failed","sending"],$=["all","platform","user","segment","role"],O=["normal","high"],U=A(wt),ee=g({id:o(),title:o(),content:o(),imageUrl:o().nullable().optional(),target:A($).default("all"),criteria:R().nullable().optional(),priority:A(O).default("normal"),scheduleDate:o().nullable().optional(),status:U,sentAt:o().nullable().optional(),createdBy:o().nullable().optional(),createdAt:o().nullable().optional(),updatedAt:o().nullable().optional(),resultSummary:R().nullable().optional()}),St=ee.pick({id:!0,title:!0,content:!0,scheduleDate:!0,status:!0,sentAt:!0});g({title:o().min(1,"Title is required").max(80),content:o().min(1,"Content is required").max(240),target:A($).default("all"),criteria:R().nullable().optional(),priority:A(O).default("normal"),status:U.default("draft"),scheduleDate:o().optional().nullable()}).superRefine((e,a)=>{(e.status==="scheduled"||e.status==="sending")&&!e.scheduleDate&&a.addIssue({code:"custom",path:["scheduleDate"],message:"Schedule date is required when status is Scheduled/Sending"})});g({q:o().optional(),status:U.optional(),page:p().int().min(1).default(1),perPage:p().int().min(1).max(100).default(10)});const Dt=g({total:p().int().nonnegative(),page:p().int().min(1),perPage:p().int().min(1)});g({data:H(St),meta:Dt});const M=g({id:X([o(),p()]),title:o().nullable().optional(),message:o().nullable().optional(),content:o().nullable().optional(),description:o().nullable().optional(),body:o().nullable().optional(),status:o().nullable().optional(),target:o().nullable().optional(),priority:o().nullable().optional(),criteria:R().nullable().optional(),image:o().nullable().optional(),image_url:o().nullable().optional(),schedule_at:o().nullable().optional(),scheduled_at:o().nullable().optional(),send_at:o().nullable().optional(),sent_at:o().nullable().optional(),created_by:X([o(),p(),g({name:o().optional()})]).nullable().optional(),created_at:o().nullable().optional(),updated_at:o().nullable().optional(),result_summary:R().nullable().optional()});function _(e){if(!e)return null;const a=e.trim();if(!a)return null;const s=new Date(a);return Number.isNaN(s.getTime())?a:s.toISOString()}function Ct(e){switch((e??"").toLowerCase()){case"scheduled":case"schedule":case"publish":case"published":return"scheduled";case"sending":return"sending";case"sent":return"sent";case"canceled":case"cancelled":return"canceled";case"failed":return"failed";case"draft":default:return"draft"}}function Pt(e){const a=(e??"").toLowerCase(),s="all";return $.includes(a)?a:s}function _t(e){const a=(e??"").toLowerCase(),s="normal";return O.includes(a)?a:s}function v(e){const a=M.parse(e),s=_(a.schedule_at)??_(a.scheduled_at)??_(a.send_at),n=_(a.sent_at??a.send_at),r=_(a.created_at),u=_(a.updated_at??a.created_at),l=a.image_url??a.image??null,m=typeof a.created_by=="object"?a.created_by?.name??null:a.created_by?String(a.created_by):null,h={id:String(a.id),title:a.title?.trim()||"Untitled notification",content:a.content??a.message??a.description??a.body??"",imageUrl:l,target:Pt(a.target),criteria:a.criteria??null,priority:_t(a.priority),scheduleDate:s,status:Ct(a.status),sentAt:n,createdBy:m,createdAt:r,updatedAt:u,resultSummary:a.result_summary??null};return ee.parse(h)}function Mt({row:e}){const a=ee.parse(e.original),{setOpen:s,setCurrentRow:n}=W();return t.jsxs(it,{modal:!1,children:[t.jsx(ot,{asChild:!0,children:t.jsxs(V,{variant:"ghost",className:"data-[state=open]:bg-muted flex h-8 w-8 p-0",children:[t.jsx(nt,{className:"h-4 w-4"}),t.jsx("span",{className:"sr-only",children:"Open menu"})]})}),t.jsxs(rt,{align:"end",className:"w-[160px]",children:[t.jsxs(oe,{onClick:()=>{n(a),s("view")},children:["View Details",t.jsx(re,{children:t.jsx(ct,{size:16})})]}),t.jsx(lt,{}),t.jsxs(oe,{onClick:()=>{n(a),s("delete")},children:["Delete",t.jsx(re,{children:t.jsx(dt,{size:16})})]})]})]})}function ce(e){if(typeof e!="string")return null;const s=new Date(e).getTime();return Number.isNaN(s)?null:s}const de=[{id:"no",header:({column:e})=>t.jsx(P,{column:e,title:"No"}),enableSorting:!1,enableHiding:!1,cell:({row:e,table:a})=>t.jsx("span",{className:"font-mono text-xs",children:ut(a,e.index)}),size:48},{accessorKey:"title",header:({column:e})=>t.jsx(P,{column:e,title:"Title"}),cell:({row:e})=>t.jsx("span",{className:"font-medium",children:e.getValue("title")}),enableSorting:!1},{accessorKey:"content",header:({column:e})=>t.jsx(P,{column:e,title:"Content"}),cell:({row:e})=>{const a=String(e.getValue("content")??""),s=a.length>50?a.substring(0,50)+"…":a;return t.jsx("span",{className:"text-muted-foreground",children:s})},enableSorting:!1},{accessorKey:"scheduleDate",header:({column:e})=>t.jsx(P,{column:e,title:"Scheduled Date"}),cell:({row:e})=>{const a=e.getValue("scheduleDate");if(!a)return t.jsx("span",{className:"text-muted-foreground",children:"—"});const s=new Date(a);return Number.isNaN(s.getTime())?t.jsx("span",{className:"text-muted-foreground",children:a}):t.jsx("span",{children:I(s,"dd MMM yyyy HH:mm",{locale:B})})},enableSorting:!1},{accessorKey:"sentAt",header:({column:e})=>t.jsx(P,{column:e,title:"Send At"}),cell:({row:e})=>{const a=e.original.sentAt;if(!a)return t.jsx("span",{className:"text-muted-foreground",children:"—"});const s=new Date(a);return Number.isNaN(s.getTime())?t.jsx("span",{className:"text-muted-foreground",children:a}):t.jsx("span",{children:I(s,"dd MMM yyyy HH:mm",{locale:B})})},enableSorting:!1},{accessorKey:"createdAt",header:({column:e})=>t.jsx(P,{column:e,title:"Created At"}),cell:({row:e})=>{const a=e.getValue("createdAt");if(!a)return t.jsx("span",{className:"text-muted-foreground",children:"—"});const s=new Date(a);return Number.isNaN(s.getTime())?t.jsx("span",{className:"text-muted-foreground",children:a}):t.jsx("span",{children:I(s,"dd MMM yyyy HH:mm",{locale:B})})},sortingFn:(e,a,s)=>{const n=ce(e.getValue(s)),r=ce(a.getValue(s));return n===null&&r===null?0:n===null?-1:r===null?1:n-r}},{id:"actions",cell:({row:e})=>t.jsx(Mt,{row:e})}],ue=fe("/_authenticated/push-notifications/");function Tt({data:e,total:a=e.length,pageCount:s,isLoading:n=!1,isFetching:r=!1,sorting:u,onSortingChange:l}){const[m,h]=b.useState({}),[c,y]=b.useState({}),{globalFilter:f,onGlobalFilterChange:i,columnFilters:d,onColumnFiltersChange:w,pagination:N,onPaginationChange:te,ensurePageInRange:z}=Le({search:ue.useSearch(),navigate:ue.useNavigate(),pagination:{defaultPage:1,defaultPageSize:10},globalFilter:{enabled:!0,key:"s",trim:!1}}),C=b.useMemo(()=>{if(typeof s=="number"&&s>0)return s;const x=N?.pageSize??10;return x<=0?1:Math.max(1,Math.ceil(a/x))},[s,N?.pageSize,a]),S=qe({data:e,columns:de,state:{sorting:u,columnVisibility:c,rowSelection:m,columnFilters:d,globalFilter:f,pagination:N},enableRowSelection:!0,onRowSelectionChange:h,onSortingChange:l??(()=>{}),onColumnVisibilityChange:y,globalFilterFn:(x,j,L)=>{const Me=String(x.getValue("id")).toLowerCase(),Te=String(x.getValue("title")).toLowerCase(),ne=String(L).toLowerCase();return Me.includes(ne)||Te.includes(ne)},getCoreRowModel:Ze(),getFilteredRowModel:Ge(),getPaginationRowModel:Qe(),getSortedRowModel:Ke(),getFacetedRowModel:Ye(),getFacetedUniqueValues:Be(),manualPagination:!0,pageCount:C,autoResetPageIndex:!1,onPaginationChange:te,onGlobalFilterChange:i,onColumnFiltersChange:w});b.useEffect(()=>{!n&&!r&&z(C)},[z,C,n,r]);const ae=S.getVisibleLeafColumns(),Ce=ae.length||de.length,Pe=Math.min(N?.pageSize?Number(N.pageSize):10,10),se=n||r,_e=!se&&a===0&&e.length===0;return t.jsxs("div",{className:"space-y-4 max-sm:has-[div[role='toolbar']]:mb-16",children:[t.jsx(Je,{table:S,searchPlaceholder:"Filter by title or ID..."}),t.jsx("div",{className:"overflow-hidden rounded-md border",children:t.jsxs(Xe,{children:[t.jsx(We,{children:S.getHeaderGroups().map(x=>t.jsx(F,{children:x.headers.map(j=>t.jsx(et,{colSpan:j.colSpan,children:j.isPlaceholder?null:ie(j.column.columnDef.header,j.getContext())},j.id))},x.id))}),t.jsx(tt,{children:se?Array.from({length:Pe}).map((x,j)=>t.jsx(F,{children:ae.map(L=>t.jsx(q,{children:t.jsx(st,{className:"h-4 w-full max-w-[220px]"})},L.id))},`loading-${j}`)):S.getRowModel().rows?.length?S.getRowModel().rows.map(x=>t.jsx(F,{"data-state":x.getIsSelected()&&"selected",children:x.getVisibleCells().map(j=>t.jsx(q,{children:ie(j.column.columnDef.cell,j.getContext())},j.id))},x.id)):t.jsx(F,{children:t.jsx(q,{colSpan:Ce,className:"h-24 text-center",children:_e?"No push notifications found.":"No results."})})})]})}),t.jsx(at,{table:S})]})}function vt(e){if(!e)return"";try{if(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}$/.test(e))return e;const a=new Date(e);if(isNaN(a.getTime()))return"";const s=n=>String(n).padStart(2,"0");return`${a.getFullYear()}-${s(a.getMonth()+1)}-${s(a.getDate())}T${s(a.getHours())}:${s(a.getMinutes())}`}catch{return""}}const At=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}$/,Rt=g({title:o().min(1,"Title is required").max(100,"Title is too long"),message:o().min(1,"Message is required").max(1e3,"Message is too long"),scheduleAt:o().optional()}).superRefine((e,a)=>{e.scheduleAt&&e.scheduleAt.trim().length>0&&!At.test(e.scheduleAt)&&a.addIssue({code:ve.custom,path:["scheduleAt"],message:"Send date must use the YYYY-MM-DDTHH:mm format."})});function me({open:e,onOpenChange:a,currentRow:s,onSubmit:n}){const r=s?"update":"create",u=b.useMemo(()=>({title:s?.title??"",message:s?.content??"",scheduleAt:vt(s?.scheduleDate??void 0)}),[s]),l=mt({resolver:pt(Rt),defaultValues:u});b.useEffect(()=>{e?l.reset(u):l.reset({title:"",message:"",scheduleAt:""})},[e,u]);const m=async c=>{const y=c.scheduleAt&&c.scheduleAt.trim().length>0?c.scheduleAt.trim():"",f={...c,scheduleAt:y};n?await n(f,s??null):gt(f,r==="create"?"You have created the following push notification:":"You have updated the following push notification:"),a(!1),l.reset()},{isSubmitting:h}=l.formState;return t.jsx(xe,{open:e,onOpenChange:c=>{a(c),c||l.reset()},children:t.jsxs(je,{className:"gap-2 sm:max-w-lg",children:[t.jsxs(be,{className:"text-start",children:[t.jsx(ye,{children:r==="create"?"Create Push Notification":"Update Push Notification"}),t.jsx(Ne,{children:r==="create"?"Compose a push notification to send now or schedule later.":"Edit the push notification details below."})]}),t.jsx(ht,{...l,children:t.jsxs("form",{id:"push-upsert-form",onSubmit:l.handleSubmit(m),className:"space-y-4",children:[t.jsx(K,{control:l.control,name:"title",render:({field:c})=>t.jsxs(Q,{children:[t.jsx(G,{children:"Title"}),t.jsx(Z,{children:t.jsx(le,{placeholder:"Stay Hydrated!",...c})}),t.jsx(J,{})]})}),t.jsx(K,{control:l.control,name:"message",render:({field:c})=>t.jsxs(Q,{children:[t.jsx(G,{children:"Message"}),t.jsx(Z,{children:t.jsx(jt,{placeholder:"Drink a glass of water to keep your body fresh.",className:"min-h-[120px]",...c})}),t.jsx(J,{})]})}),t.jsx(K,{control:l.control,name:"scheduleAt",render:({field:c})=>t.jsxs(Q,{children:[t.jsx(G,{children:"Schedule send time"}),t.jsx(Z,{children:t.jsx(le,{className:"w-fit",type:"datetime-local",placeholder:"Optional",...c})}),t.jsx(J,{})]})})]})}),t.jsxs(ft,{className:"gap-2",children:[t.jsx(xt,{asChild:!0,children:t.jsx(V,{variant:"outline",disabled:h,children:"Close"})}),t.jsx(V,{type:"submit",form:"push-upsert-form",disabled:h,children:h?r==="create"?"Creating...":"Updating...":r==="create"?"Create":"Update"})]})]})})}const Ft=g({data:H(M),current_page:p().int().nonnegative(),per_page:p().int().positive(),total:p().int().nonnegative(),last_page:p().int().nonnegative().optional(),next_page_url:o().nullable().optional(),prev_page_url:o().nullable().optional()}),Et=g({total:p().int().nonnegative(),per_page:p().int().positive(),current_page:p().int().nonnegative(),last_page:p().int().nonnegative().optional(),from:p().int().nonnegative().optional(),to:p().int().nonnegative().optional(),next_page_url:o().nullable().optional(),prev_page_url:o().nullable().optional()}),It=g({items:H(M),pagination:Et}),Vt=g({message:o().optional(),data:X([Ft,It]).optional()}),Ht=g({message:o().optional(),data:H(M).optional()});function kt({page:e=1,perPage:a=10,sort:s,search:n}){return{page:e,per_page:a,...s?{sort:s}:{},...n&&n.trim().length>0?{s:n.trim()}:{}}}async function $t(e={}){const{page:a=1,perPage:s=10}=e,n=await k.get("/api/admin/push-notifications",{params:kt(e)}),r=Vt.safeParse(n.data);if(r.success&&r.data.data){const{data:l,message:m}=r.data;if("data"in l){const{data:h,current_page:c,per_page:y,total:f,last_page:i,next_page_url:d,prev_page_url:w}=l;return{notifications:h.map(v),pagination:{page:c,perPage:y,total:f,lastPage:i,hasNext:typeof d<"u"?!!d:typeof i=="number"?c<i:!1,hasPrevious:typeof w<"u"?!!w:c>1},rawMessage:m}}if("items"in l){const{items:h,pagination:{current_page:c,per_page:y,total:f,last_page:i,next_page_url:d,prev_page_url:w}}=l;return{notifications:h.map(v),pagination:{page:c,perPage:y,total:f,lastPage:i,hasNext:typeof d<"u"?!!d:typeof i=="number"?c<i:!1,hasPrevious:typeof w<"u"?!!w:c>1},rawMessage:m}}}const u=Ht.safeParse(n.data);if(u.success&&u.data.data){const l=u.data.data.map(v),m=l.length;return{notifications:l,pagination:{page:a,perPage:s,total:m,lastPage:Math.max(1,Math.ceil(m/s)),hasNext:!1,hasPrevious:a>1&&a<=Math.ceil(m/s)},rawMessage:u.data.message}}throw new Error("Unable to parse push notifications response.")}const Se=["admin","push-notifications"];function Ot({page:e,perPage:a,sort:s,search:n,enabled:r=!0}){return Ie({queryKey:[...Se,{page:e??1,perPage:a??10,sort:s??"desc",search:n??""}],queryFn:()=>$t({page:e,perPage:a,sort:s,search:n}),placeholderData:Ae,enabled:r,staleTime:1e3*30})}function Ut(e){switch(e){case"scheduled":return"publish";case"sending":return"sending";case"sent":return"sent";case"canceled":return"canceled";case"failed":return"failed";case"draft":default:return"draft"}}function zt(e){if(!e)return null;const a=e.trim();if(!a)return null;const s=new Date(a);if(!Number.isNaN(s.getTime())){const n=r=>String(r).padStart(2,"0");return`${s.getFullYear()}-${n(s.getMonth()+1)}-${n(s.getDate())} ${n(s.getHours())}:${n(s.getMinutes())}:${n(s.getSeconds())}`}return a}function De(e){if(!U.safeParse(e.status).success)throw new Error("Invalid status value");const a=zt(e.scheduleDate),s={title:e.title,content:e.content,message:e.content,status:Ut(e.status)};return a!==null&&(s.schedule_at=a),e.target&&$.includes(e.target)&&(s.target=e.target),e.priority&&O.includes(e.priority)&&(s.priority=e.priority),s}const Lt=g({message:o().optional(),data:M.optional()});async function qt(e){const a=await k.post("/api/admin/push-notifications",De(e)),s=Lt.safeParse(a.data);if(!s.success)throw new Error("Unable to parse create response.");return{notification:s.data.data?v(s.data.data):void 0,message:s.data.message}}const Bt=g({message:o().optional(),data:M.optional()});async function Yt(e,a){const s=await k.put(`/api/admin/push-notifications/${e}`,De(a)),n=Bt.safeParse(s.data);if(!n.success)throw new Error("Unable to parse update response.");return{notification:n.data.data?v(n.data.data):void 0,message:n.data.message}}const Kt=g({message:o().optional()});async function Qt(e){const a=await k.delete(`/api/admin/push-notifications/${e}`),s=Kt.safeParse(a.data);if(!s.success)throw new Error("Unable to parse delete response.");return s.data.message}function E(e){if(!e)return{display:"—",raw:null};const a=new Date(e);return Number.isNaN(a.getTime())?{display:e,raw:e}:{display:I(a,"dd MMM yyyy HH:mm"),raw:e}}function Gt(e){switch(e){case"sent":return"default";case"scheduled":case"sending":return"secondary";case"failed":case"canceled":return"destructive";default:return"outline"}}function T(e){if(!e)return"—";const a=e.trim();return a.length>0?a:"—"}function Zt(e){if(e===null||typeof e>"u")return"";if(typeof e=="string")return e;try{return JSON.stringify(e,null,2)}catch{return String(e)}}function Jt({notification:e,open:a,onOpenChange:s}){if(!e)return null;const n=E(e.scheduleDate),r=E(e.sentAt),u=E(e.createdAt),l=E(e.updatedAt),m=e.resultSummary!==null&&typeof e.resultSummary<"u";return t.jsx(xe,{open:a,onOpenChange:s,children:t.jsxs(je,{className:"sm:max-w-2xl",children:[t.jsxs(be,{children:[t.jsx(ye,{children:"Push notification detail"}),t.jsx(Ne,{children:T(e.title)})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("section",{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsx("p",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Status"}),t.jsx(bt,{variant:Gt(e.status),children:e.status})]}),t.jsxs("dl",{className:"grid gap-4 sm:grid-cols-2",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsx("dt",{className:"text-xs uppercase text-muted-foreground",children:"Target"}),t.jsx("dd",{className:"text-sm",children:T(e.target)})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("dt",{className:"text-xs uppercase text-muted-foreground",children:"Priority"}),t.jsx("dd",{className:"text-sm",children:T(e.priority)})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("dt",{className:"text-xs uppercase text-muted-foreground",children:"Schedule Date"}),t.jsx("dd",{className:"text-sm",children:n.display})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("dt",{className:"text-xs uppercase text-muted-foreground",children:"Send At (send_at)"}),t.jsxs("dd",{className:"text-sm space-y-1",children:[t.jsx("span",{children:r.display}),r.raw&&r.raw!==r.display&&t.jsxs("span",{className:"block text-xs text-muted-foreground",children:["Raw: ",r.raw]})]})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("dt",{className:"text-xs uppercase text-muted-foreground",children:"Created At"}),t.jsx("dd",{className:"text-sm",children:u.display})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("dt",{className:"text-xs uppercase text-muted-foreground",children:"Updated At"}),t.jsx("dd",{className:"text-sm",children:l.display})]})]})]}),t.jsxs("section",{className:"space-y-2",children:[t.jsx("p",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Title"}),t.jsx("p",{className:"rounded-md border bg-muted/40 p-3 text-sm font-medium",children:T(e.title)})]}),t.jsxs("section",{className:"space-y-2",children:[t.jsx("p",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Content"}),t.jsx("p",{className:"rounded-md border bg-muted/40 p-3 text-sm whitespace-pre-wrap",children:T(e.content)})]}),m&&t.jsxs("section",{className:"space-y-2",children:[t.jsx("p",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Result Summary"}),t.jsx("pre",{className:"rounded-md border bg-muted/30 p-3 text-xs overflow-x-auto",children:Zt(e.resultSummary)})]})]})]})})}function Xt(e){return e?"scheduled":"draft"}function pe(e){const a=e.scheduleAt?.trim()??"",s=a.length>0?a:null;return{title:e.title.trim(),content:e.message.trim(),status:Xt(s),scheduleDate:s,target:"all",priority:"normal"}}function Wt(){const{open:e,setOpen:a,currentRow:s,setCurrentRow:n}=W(),r=Re(),u=b.useCallback(async()=>{await r.invalidateQueries({queryKey:Se})},[r]),l=Y({mutationFn:async i=>qt(pe(i)),onSuccess:async i=>{await u(),D.success(i.message??"Push notification created successfully."),a(null)},onError:i=>{const d=i instanceof Error?i.message:"Failed to create push notification.";D.error(d)}}),m=Y({mutationFn:async({id:i,values:d})=>Yt(i,pe(d)),onSuccess:async i=>{await u(),D.success(i.message??"Push notification updated successfully."),a(null),n(null)},onError:i=>{const d=i instanceof Error?i.message:"Failed to update push notification.";D.error(d)}}),h=Y({mutationFn:async i=>Qt(i),onSuccess:async i=>{await u(),D.success(i??"Push notification deleted successfully."),a(null),n(null)},onError:i=>{const d=i instanceof Error?i.message:"Failed to delete push notification.";D.error(d)}}),c=async i=>{await l.mutateAsync(i)},y=async(i,d)=>{d&&await m.mutateAsync({id:d.id,values:i})},f=async()=>{s&&await h.mutateAsync(s.id)};return t.jsxs(t.Fragment,{children:[t.jsx(me,{open:e==="create",onOpenChange:i=>a(i?"create":null),onSubmit:c},"push-notifications-create"),s&&t.jsxs(t.Fragment,{children:[t.jsx(me,{open:e==="update",onOpenChange:i=>{i?a("update"):(a(null),n(null))},currentRow:s,onSubmit:i=>y(i,s)},`push-notifications-update-${s.id}`),t.jsx(Ve,{destructive:!0,open:e==="delete",onOpenChange:i=>{i?a("delete"):(a(null),n(null))},handleConfirm:()=>{f()},isLoading:h.isPending,className:"max-w-md",title:`Delete push notification: ${s.title||s.id}?`,desc:t.jsxs(t.Fragment,{children:["You are about to delete the push notification"," ",t.jsx("strong",{children:s.title||s.id}),". ",t.jsx("br",{}),"This action cannot be undone."]}),confirmText:"Delete"},`push-notifications-delete-${s.id}`),t.jsx(Jt,{open:e==="view",onOpenChange:i=>{i?a("view"):(a(null),n(null))},notification:s},`push-notifications-view-${s.id}`)]})]})}const he=fe("/_authenticated/push-notifications/");function ea(){const e=he.useSearch(),a=he.useNavigate(),s=e.page??1,n=e.pageSize??10,r=e.sort==="asc"?"asc":"desc",u=typeof e.s=="string"&&e.s.trim().length>0?e.s:void 0,{data:l,isLoading:m,isFetching:h,error:c}=Ot({page:s,perPage:n,sort:r,search:u});b.useEffect(()=>{c instanceof Error&&D.error(c.message)},[c]);const y=l?.notifications??[],f=l?.pagination.total??0,i=b.useMemo(()=>l?.pagination.lastPage&&l.pagination.lastPage>0?l.pagination.lastPage:n>0?Math.max(1,Math.ceil(f/n)):1,[l?.pagination.lastPage,f,n]),d=b.useMemo(()=>[{id:"createdAt",desc:r!=="asc"}],[r]),w=b.useCallback(N=>{const C=(typeof N=="function"?N(d):N)[0]?.desc===!1?"asc":"desc";a({search:S=>({...S,page:void 0,sort:C==="desc"?void 0:C})})},[a,d]);return t.jsxs(yt,{children:[t.jsxs(He,{fixed:!0,children:[t.jsx(ke,{}),t.jsxs("div",{className:"ms-auto flex items-center space-x-4",children:[t.jsx(Ue,{}),t.jsx(Fe,{}),t.jsx(Oe,{})]})]}),t.jsxs($e,{children:[t.jsxs("div",{className:"mb-2 flex flex-wrap items-center justify-between space-y-2 gap-x-4",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Push Notifications"}),t.jsx("p",{className:"text-muted-foreground",children:"Here's a list of your push notifications!"})]}),t.jsx(Nt,{})]}),t.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-y-0 lg:space-x-12",children:t.jsx(Tt,{data:y,total:f,pageCount:i,isLoading:m,isFetching:h,sorting:d,onSortingChange:w})})]}),t.jsx(Wt,{})]})}const Ua=ea;export{Ua as component};
