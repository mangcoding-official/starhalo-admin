import{u as x,a as o,j as t,r as j,B as v}from"./index-PJSoALqW.js";import{C as w,u as y,a as U,A as C,b as D,c as N}from"./search-DNskT_XA.js";import{D as b,f as A,g as S,h as M,i as F,j as O,O as T}from"./dropdown-menu-C13Htoa9.js";import{u as E}from"./layout-provider-BCzdurxv.js";import{a as k}from"./api-client-d_HjdnGb.js";function L({open:e,onOpenChange:a}){const n=x(),s=E(),{auth:i}=o(),c=()=>{i.reset();const r=s.href;n({to:"/sign-in",search:{redirect:r},replace:!0})};return t.jsx(w,{open:e,onOpenChange:a,title:"Sign out",desc:"Are you sure you want to sign out? You will need to sign in again to access your account.",confirmText:"Sign out",handleConfirm:c,className:"sm:max-w-sm"})}function P(e){return!e||typeof e!="object"?null:e.data&&typeof e.data=="object"?e.data:e.user&&typeof e.user=="object"?e.user:null}async function B(){const{data:e}=await k.get("/api/auth/me"),a=P(e);if(!a)throw new Error(e?.message??"Unable to retrieve current user.");return a}const I=["auth","me"];function q(){const e=o(s=>s.auth.accessToken),a=o(s=>s.auth.setUser),n=y({queryKey:I,queryFn:B,enabled:!!e,staleTime:5*60*1e3,gcTime:15*60*1e3,refetchOnWindowFocus:!1});return j.useEffect(()=>{n.status==="success"&&n.data&&a(n.data)},[n.status,n.data,a]),n}function Q(e){if(!e)return"NA";const a=e.trim().split(/\s+/).filter(Boolean);return a.length===0?"NA":a.length===1?a[0].slice(0,2).toUpperCase():(a[0][0]+a[a.length-1][0]).toUpperCase()}function G(){const[e,a]=U(),n=o(p=>p.auth.user),{data:s,isLoading:i,isFetching:c}=q(),r=s??n,u=typeof r?.profile=="object"&&typeof r.profile?.username=="string"?r.profile.username.trim():void 0,l=(u&&u.length>0?u:void 0)??r?.name??"Authenticated User",g=r?.email??"Signed in",d=(typeof r?.profile=="object"?r?.profile?.avatar??void 0:void 0)??r?.avatar??void 0,f=typeof d=="string"&&d.trim().length>0?d:void 0,h=Q(l),m=i||c;return t.jsxs(t.Fragment,{children:[t.jsxs(b,{modal:!1,children:[t.jsx(A,{asChild:!0,children:t.jsx(v,{variant:"ghost",className:"relative h-8 w-8 rounded-full",children:t.jsxs(C,{className:"h-8 w-8",children:[f?t.jsx(D,{src:f,alt:l??"Profile avatar"}):null,t.jsx(N,{children:h})]})})}),t.jsxs(S,{className:"w-56",align:"end",forceMount:!0,children:[t.jsx(M,{className:"font-normal",children:t.jsxs("div",{className:"flex flex-col gap-1.5",children:[t.jsx("p",{className:"text-sm leading-none font-medium",children:m?"Loading...":l}),t.jsx("p",{className:"text-muted-foreground text-xs leading-none",children:m?"Fetching account details":g})]})}),t.jsx(F,{}),t.jsxs(O,{onClick:()=>a(!0),children:["Sign out",t.jsx(T,{children:"⇧⌘Q"})]})]})]}),t.jsx(L,{open:!!e,onOpenChange:a})]})}export{G as P};
