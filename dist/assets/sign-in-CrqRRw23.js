import{c as C,u as E,r as x,a as P,b as M,o as D,j as s,d as T,B as v,s as R,e as U,t as j,A as q,f as B}from"./index-DpFIowpL.js";import{C as H,a as O,b as V,c as G,d as z}from"./card-sEkhbL22.js";import{A as J}from"./auth-layout-BwujhUPi.js";import{u as K,a as Q,F as W,b as y,c as b,d as I,e as _,f as k}from"./form-CBubDuqC.js";import{a as X}from"./api-client-BW-LdrQ3.js";import{I as Y}from"./input-D0A8Fyyz.js";import{P as Z}from"./password-input-BZoCohvp.js";import{L as $}from"./loader-circle-B9jbvCR7.js";import"./logo-3Wsd-wPn.js";import"./index-BQzvqra1.js";import"./eye-BxA0sPvX.js";const ee=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],se=C("log-in",ee),re="/api/auth/admin/login";function w(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function te(e){if(!e||!e.data||typeof e.data=="boolean"||!w(e.data))return null;const r=e.data,i=typeof r=="object"&&r!==null?r.expires_in:void 0;let t=null;if(typeof i=="number")t=Number.isFinite(i)?i:null;else if(typeof i=="string"){const c=Number(i);t=Number.isFinite(c)?c:null}return typeof r.access_token!="string"||typeof r.refresh_token!="string"||typeof r.token_type!="string"||!w(r.user)?null:{access_token:r.access_token,refresh_token:r.refresh_token,token_type:r.token_type,expires_in:t,user:r.user}}function g(e){if(e&&typeof e.message=="string"&&e.message.trim().length>0)return e.message}function S(e,r,i){const t=r?.errors;!t||typeof t!="object"||Object.entries(t).forEach(([c,l])=>{const u=typeof l=="string"?l:Array.isArray(l)?l.filter(p=>typeof p=="string").join(", "):i;u&&(c in e.getValues()?e.setError(c,{message:u}):e.setError("root",{message:u}))})}const ne=e=>D({email:U({error:r=>r.input===""?e("auth.signIn.fields.email.required","Please enter your email"):void 0}),password:R().min(1,e("auth.signIn.fields.password.required","Please enter your password")).min(7,e("auth.signIn.fields.password.minLength","Password must be at least 7 characters long"))});function oe({className:e,redirectTo:r,...i}){const{t}=E(),[c,l]=x.useState(!1),u=P(),{auth:p}=M(),F=x.useMemo(()=>ne(t),[t]),o=K({resolver:Q(F),defaultValues:{email:"",password:""}});async function N(m){l(!0),o.clearErrors();const h=t("auth.signIn.error.default","Unable to sign in. Please try again.");try{const{data:a}=await X.post(re,m),n=te(a);if(!n){const f=g(a)??h;throw S(o,a,f),o.formState.errors.root||o.setError("root",{message:f}),new Error(f)}const d=typeof n.expires_in=="number"&&n.expires_in>0?n.expires_in:null,L=d!==null?Date.now()+d*1e3:null;p.setSession({accessToken:n.access_token,refreshToken:n.refresh_token,tokenType:n.token_type,expiresAt:L}),p.setUser(n.user);const A=g(a)??t("auth.signIn.success","Login successfully");j.success(A),u({to:r||"/users",replace:!0})}catch(a){let n=h;if(a instanceof q){const d=a.response?.data??null;S(o,d,n),n=g(d)??n}else a instanceof Error&&a.message&&(n=a.message);!o.formState.errors.root&&n&&o.setError("root",{message:n}),j.error(n)}finally{l(!1)}}return s.jsx(W,{...o,children:s.jsxs("form",{onSubmit:o.handleSubmit(N),className:T("grid gap-3",e),...i,children:[s.jsx(y,{control:o.control,name:"email",render:({field:m})=>s.jsxs(b,{children:[s.jsx(I,{children:t("auth.signIn.fields.email.label","Email")}),s.jsx(_,{children:s.jsx(Y,{placeholder:t("auth.signIn.fields.email.placeholder","name@example.com"),...m})}),s.jsx(k,{})]})}),s.jsx(y,{control:o.control,name:"password",render:({field:m})=>s.jsxs(b,{className:"relative",children:[s.jsx(I,{children:t("auth.signIn.fields.password.label","Password")}),s.jsx(_,{children:s.jsx(Z,{placeholder:t("auth.signIn.fields.password.placeholder","********"),...m})}),s.jsx(k,{})]})}),s.jsxs(v,{className:"mt-2",disabled:c,type:"submit",children:[c?s.jsx($,{className:"animate-spin"}):s.jsx(se,{}),t("auth.signIn.button","Sign in")]}),o.formState.errors.root?.message?s.jsx("p",{className:"text-destructive text-sm font-medium",children:o.formState.errors.root.message}):null]})})}function ae(){const{redirect:e}=B({from:"/(auth)/sign-in"}),{t:r}=E();return s.jsx(J,{children:s.jsxs(H,{className:"gap-4",children:[s.jsxs(O,{children:[s.jsx(V,{className:"text-lg tracking-tight",children:r("auth.signIn.title","Sign in")}),s.jsxs(G,{children:[r("auth.signIn.description.line1","Enter your email and password below to")," ",s.jsx("br",{}),r("auth.signIn.description.line2","log into your account")]})]}),s.jsx(z,{children:s.jsx(oe,{redirectTo:e})})]})})}const ye=ae;export{ye as component};
