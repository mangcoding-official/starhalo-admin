import{a as v,b as l,u as p,j as t,r as w,B as y}from"./index-DpFIowpL.js";import{C as U,u as C,a as D,A as N,b,c as A}from"./search-BvEeOfrC.js";import{D as O,f as S,g as M,h as T,i as F,j as E,O as k}from"./dropdown-menu-DRiR6jwX.js";import{u as L}from"./layout-provider-DBFuSN2z.js";import{a as P}from"./api-client-BW-LdrQ3.js";function B({open:e,onOpenChange:a}){const n=v(),o=L(),{auth:c}=l(),{t:i}=p(),s=()=>{c.reset();const r=o.href;n({to:"/sign-in",search:{redirect:r},replace:!0})};return t.jsx(U,{open:e,onOpenChange:a,title:i("signOut.dialog.title","Sign out"),desc:i("signOut.dialog.desc","Are you sure you want to sign out? You will need to sign in again to access your account."),confirmText:i("signOut.dialog.confirm","Sign out"),handleConfirm:s,className:"sm:max-w-sm"})}function I(e){return!e||typeof e!="object"?null:e.data&&typeof e.data=="object"?e.data:e.user&&typeof e.user=="object"?e.user:null}async function q(){const{data:e}=await P.get("/api/auth/me"),a=I(e);if(!a)throw new Error(e?.message??"Unable to retrieve current user.");return a}const Q=["auth","me"];function z(){const e=l(o=>o.auth.accessToken),a=l(o=>o.auth.setUser),n=C({queryKey:Q,queryFn:q,enabled:!!e,staleTime:5*60*1e3,gcTime:15*60*1e3,refetchOnWindowFocus:!1});return w.useEffect(()=>{n.status==="success"&&n.data&&a(n.data)},[n.status,n.data,a]),n}function K(e){if(!e)return"NA";const a=e.trim().split(/\s+/).filter(Boolean);return a.length===0?"NA":a.length===1?a[0].slice(0,2).toUpperCase():(a[0][0]+a[a.length-1][0]).toUpperCase()}function J(){const[e,a]=D(),n=l(j=>j.auth.user),{data:o,isLoading:c,isFetching:i}=z(),{t:s}=p(),r=o??n,u=typeof r?.profile=="object"&&typeof r.profile?.username=="string"?r.profile.username.trim():void 0,d=(u&&u.length>0?u:void 0)??r?.name??s("profile.placeholder.name","Authenticated User"),h=r?.email??s("profile.placeholder.email","Signed in"),f=(typeof r?.profile=="object"?r?.profile?.avatar??void 0:void 0)??r?.avatar??void 0,g=typeof f=="string"&&f.trim().length>0?f:void 0,x=K(d),m=c||i;return t.jsxs(t.Fragment,{children:[t.jsxs(O,{modal:!1,children:[t.jsx(S,{asChild:!0,children:t.jsx(y,{variant:"ghost",className:"relative h-8 w-8 rounded-full",children:t.jsxs(N,{className:"h-8 w-8",children:[g?t.jsx(b,{src:g,alt:d??s("profile.avatar.alt","Profile avatar")}):null,t.jsx(A,{children:x})]})})}),t.jsxs(M,{className:"w-56",align:"end",forceMount:!0,children:[t.jsx(T,{className:"font-normal",children:t.jsxs("div",{className:"flex flex-col gap-1.5",children:[t.jsx("p",{className:"text-sm leading-none font-medium",children:m?s("profile.loading","Loading..."):d}),t.jsx("p",{className:"text-muted-foreground text-xs leading-none",children:m?s("profile.fetching","Fetching account details"):h})]})}),t.jsx(F,{}),t.jsxs(E,{onClick:()=>a(!0),children:[s("profile.dropdown.signOut","Sign out"),t.jsx(k,{children:"⇧⌘Q"})]})]})]}),t.jsx(B,{open:!!e,onOpenChange:a})]})}export{J as P};
